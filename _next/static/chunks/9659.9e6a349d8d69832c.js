"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9659],{79659:(e,t,a)=>{a.r(t),a.d(t,{default:()=>w});var i=a(74848),r=a(16286),n=a(96540);let l=a(33540).Ay.div.withConfig({componentId:"sc-16d5cff3-0"})(["#vimjs-canvas{image-rendering:pixelated;}#vimjs-container{height:100%;width:100%;}#vimjs-file{display:none;}#vimjs-font-test{position:absolute;visibility:hidden;}"]);var s=a(16602),o=a(8218),u=a(55650),c=a(25559),m=a(99204),d=a(48060),f=a(37e3),p=a(48287).Buffer;let w=({id:e})=>{let{closeWithTransition:t,processes:{[e]:a}}=(0,m.N)(),{readFile:w,updateFolder:h,writeFile:v}=(0,c.f)(),b=(0,s.A)(),{prependFileToTitle:$}=(0,u.A)(e),{libs:g=[],url:j=""}=a||{},[y,V]=(0,n.useState)([]),A=(0,n.useRef)(!1),C=(0,n.useCallback)(async()=>{let a=j||d.nB,[,...i]=a.split("/"),n="";1===i.length&&(n="/root"),window.VimWrapperModule={},await (0,f.aY)(g,!1,!!window.VimWrapperModule);let l=j?await w(a):p.from("");window.VimWrapperModule?.init?.({VIMJS_ALLOW_EXIT:!0,arguments:[`${n}${a}`],containerWindow:document.querySelector("#vimjs-container")?.closest("section"),memoryInitializerPrefixURL:"/Program Files/Vim.js/",postRun:[()=>{A.current=!1,b(window.VimWrapperModule?.VimModule?.FS,"Vim")}],preRun:[()=>{let e="";[n,...i].forEach((t,a,{[a+1]:r})=>{r&&a+1!==i.length?(window.VimWrapperModule?.VimModule?.FS_createPath?.(e,r,!0,!0),e+=`/${r}`):e?window.VimWrapperModule?.VimModule?.FS_createDataFile?.(e,t,l,!0,!0):e=t})}],print:console.info,printErr:console.info,quitCallback:()=>t(e),writeCallback:e=>V(t=>[...t,{buffer:p.from(e),url:a}])}),$((0,r.basename)(a))},[t,e,g,b,$,w,j]);return(0,n.useEffect)(()=>{y.length>0&&([...y].forEach(({buffer:e,url:t})=>{v(t,e,!0),h((0,r.dirname)(t),(0,r.basename)(t))}),V([]))},[h,y,v]),(0,n.useEffect)(()=>(A.current||(A.current=!0,C()),()=>{!A&&window.VimWrapperModule?.VimModule?.asmLibraryArg?._vimjs_prepare_exit()&&window.VimWrapperModule?.VimModule?.exit?.()}),[C]),(0,i.jsxs)(l,{children:[(0,i.jsx)("div",{id:"vimjs-container",...(0,o.A)({id:e}),children:(0,i.jsx)("canvas",{id:"vimjs-canvas",onContextMenuCapture:f.CH})}),(0,i.jsx)("div",{id:"vimjs-font-test"})]})}},16602:(e,t,a)=>{a.d(t,{A:()=>n});var i=a(96540),r=a(25559);let n=()=>{let{mountEmscriptenFs:e,unMapFs:t,updateFolder:a}=(0,r.f)(),n=(0,i.useRef)("");return(0,i.useEffect)(()=>()=>{if(n.current){let e=n.current;n.current="",t(e,!0).then(()=>a("/",void 0,e)).catch(()=>{})}},[t,a]),(0,i.useCallback)(async(t,i)=>{if(!t)return;let r="";try{r=await e(t,i)}catch{}r&&(a("/",r),n.current=r)},[e,a])}},8218:(e,t,a)=>{a.d(t,{A:()=>p});var i=a(16286),r=a(96540),n=a(51780),l=a(16091),s=a(13296),o=a(25559),u=a(99204),c=a(45694),m=a(48060),d=a(37e3),f=a(63461);let p=({callback:e,directory:t=m.Bn,id:a,onDragLeave:p,onDragOver:w,updatePositions:h})=>{let{url:v}=(0,u.N)(),b=(0,f.w)(),{iconPositions:$,sortOrders:g,setIconPositions:j}=(0,c.w)(),{exists:y,mkdirRecursive:V,updateFolder:A,writeFile:C}=(0,o.f)(),M=(0,r.useCallback)(async(e,t,r)=>{if(a){if(t){let n=(0,i.join)(m.Bn,e);if(await V(m.Bn),await C(n,t,!0))return r===s.z.UPDATE_URL&&v(a,n),A(m.Bn,e),(0,i.basename)(n)}else r===s.z.UPDATE_URL&&v(a,e)}return""},[a,V,A,v,C]),{openTransferDialog:k}=(0,n.A)();return{onDragLeave:p,onDragOver:(0,r.useCallback)(e=>{w?.(e),(0,d.CH)(e)},[w]),onDrop:(0,r.useCallback)(r=>{if(m.jj.has((0,d.uQ)(t)))return;if(h&&r.target instanceof HTMLElement){let{files:e,text:a}=(0,l.bn)(r);if(0===e.length&&""===a)return;(async()=>{let n={x:r.clientX,y:r.clientY},l=[];if(a){try{l=JSON.parse(a)}catch{}if(!Array.isArray(l))return;let[e]=l;if(!e||e.startsWith(t)&&(0,i.basename)(e)===(0,i.relative)(t,e))return;l=l.map(e=>(0,i.basename)(e))}else e instanceof FileList?l=[...e].map(e=>e.name):l=[...e].map(e=>e.getAsFile()?.name||"").filter(Boolean);l=await Promise.all(l.map(async e=>{let a=`${t}/${e}`;if(!$[a]||!await y(a))return e;let r=0;do r+=1,a=`${t}/${(0,i.basename)(e,(0,i.extname)(e))} (${r})${(0,i.extname)(e)}`;while($[a]&&await y(a));return(0,i.basename)(a)})),(0,d.$Y)(t,r.target,$,g,n,l,j,y)})()}let n="string"==typeof a;n&&!h&&t===m.Bn&&b.current[a]?.componentWindow?.focus(m.VD),(0,l.nX)(r,e||M,t,k,n)},[e,t,y,$,a,k,b,j,g,h,M])}}},55650:(e,t,a)=>{a.d(t,{A:()=>s});var i=a(96540),r=a(99204),n=a(25573),l=a(48060);let s=e=>{let{title:t}=(0,r.N)(),[a]=e.split(l.QB),{title:s}=n.A[a]||{};return{appendFileToTitle:(0,i.useCallback)((a,i)=>{let r=a?` - ${a}${i?` ${l.g6}`:""}`:"";t(e,`${s}${r}`)},[e,s,t]),prependFileToTitle:(0,i.useCallback)((a,i,r)=>{let n=a?`${i?`${l.g6} `:""}${a}${r?" ":" - "}`:"";t(e,`${n}${s}`)},[e,s,t])}}}}]);