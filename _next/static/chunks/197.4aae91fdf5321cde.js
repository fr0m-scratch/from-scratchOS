"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[197],{30197:(e,t,r)=>{r.d(t,{decodeImageToBuffer:()=>p,getFirstAniImage:()=>f,getLargestIcon:()=>m});var a=r(48060),n=r(48287).Buffer;function s(e,t=[]){let{length:r}=t,a=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)].concat(t);return[r>>24&255,r>>16&255,r>>8&255,255&r].concat(a,function(e){let t=[],r=0;for(let e=0;e<256;++e)r=1&(r=1&(r=1&(r=1&(r=1&(r=1&(r=1&(r=1&(r=e)?0xedb88320^r>>>1:r>>>1)?0xedb88320^r>>>1:r>>>1)?0xedb88320^r>>>1:r>>>1)?0xedb88320^r>>>1:r>>>1)?0xedb88320^r>>>1:r>>>1)?0xedb88320^r>>>1:r>>>1)?0xedb88320^r>>>1:r>>>1)?0xedb88320^r>>>1:r>>>1,t[e]=r;for(let a of(r=-1,e))r=r>>>8^t[(r^a)&255];return[(r^=-1)>>24&255,r>>16&255,r>>8&255,255&r]}(a))}let i=e=>n.from(new Uint8Array(function(e){if(e.length<22||113!==e[0]||111!==e[1]||105!==e[2]||102!==e[3])return;let t=e[4]<<24|e[5]<<16|e[6]<<8|e[7],r=e[12],a=e[13];if(3!==r&&4!==r&&1!==a)return;let n=e.length-8,i=[],c=Array.from({length:64}).fill(0),l=255,u=14;for(;u<n;){let t=e[u],r=t>>6;if(255===t){let t=e[u+1],r=e[u+2],a=e[u+3],n=e[u+4];u+=5,l=t<<24|r<<16|a<<8|n,c[(3*t+5*r+7*a+11*n)%64]=l,i.push(l)}else if(254===t){let t=e[u+1],r=e[u+2],a=e[u+3],n=255&l;u+=4,l=t<<24|r<<16|a<<8|n,c[(3*t+5*r+7*a+11*n)%64]=l,i.push(l)}else if(0===r){if(0===e[u]&&0===e[u+1]&&0===e[u+2]&&0===e[u+3]&&0===e[u+4]&&0===e[u+5]&&0===e[u+6]&&1===e[u+7])break;u+=1,l=c[t],i.push(l)}else if(1===r){let e=(l>>24&255)+((t>>4&3)-2)&255,r=(l>>16&255)+((t>>2&3)-2)&255,a=(l>>8&255)+((3&t)-2)&255,n=255&l;u+=1,l=e<<24|r<<16|a<<8|n,c[(3*e+5*r+7*a+11*n)%64]=l,i.push(l)}else if(2===r){let r=e[u+1],a=(63&t)-32&255,n=(r>>4&15)-8+a&255,s=(15&r)-8+a&255,h=(l>>24&255)+n&255,o=(l>>16&255)+a&255,d=(l>>8&255)+s&255,f=255&l;u+=2,l=h<<24|o<<16|d<<8|f,c[(3*h+5*o+7*d+11*f)%64]=l,i.push(l)}else{for(let e=(63&t)+1;e>0;--e)i.push(l);u+=1}}return function(e,t,r){let a=[],n=[120,1],i=1+t*r,c=65535^i;for(let s=0;e.length!=s;s+=t){let l=s+t;n.push(l===e.length?1:0,255&i,i>>8&255,255&c,c>>8&255),a.push(1),n.push(0);for(let t=s;l!==t;++t){let s=e[t];a.push(s>>24&255),n.push(s>>24&255),a.push(s>>16&255),n.push(s>>16&255),a.push(s>>8&255),n.push(s>>8&255),4===r&&(a.push(255&s),n.push(255&s))}}let l=e.length/t;return[137,80,78,71,13,10,26,10].concat(s("IHDR",[t>>24&255,t>>16&255,t>>8&255,255&t,l>>24&255,l>>16&255,l>>8&255,255&l,8,3===r?2:6,0,0,0]),s("IDAT",n.concat(function(e){let t=0,r=0;for(let a of e)r=(r+(t=(t+a)%65521))%65521;return[r>>8,255&r,t>>8,255&t]}(a))),s("IEND"))}(i,t,r)}(new Uint8Array(e))));var c=r(37e3),l=r(48287).Buffer;let u=async e=>{let t=document.createElement("img");return document.createElement("picture").append(Object.assign(document.createElement("source"),{srcset:"data:,x",type:e}),t),await new Promise(e=>{requestAnimationFrame(e)}),"string"==typeof t.currentSrc&&t.currentSrc.length>0},h=async e=>await u("image/jxl")?e:new Promise(t=>{let r=new Worker("System/JXL.js/jxl_dec.js");r.postMessage({image:e,jxlSrc:"image.jxl"}),r.addEventListener("message",e=>{t((0,c.Jf)(e?.data?.imgData)),r.terminate()})}),o=async e=>await u("image/heic")?e:new Promise(t=>{let a=new Worker(r.tu(new URL(r.p+r.u(5296),r.b)),{name:"libheif"});a.postMessage(e),a.addEventListener("message",({data:e})=>{t((0,c.Jf)(e)),a.terminate()})}),d=async e=>{let t=await (0,c.iI)(),{parseAni:n}=await r.e(8956,"high").then(r.bind(r,18956)),s=[];try{({images:s}=n(e))}catch{return e}return await Promise.all(s.map(e=>new Promise(r=>{let n=new Image,s=(0,c.Zd)(l.from(e));t.setOptions({transparent:""}),n.addEventListener("load",()=>{t.addFrame(n),(0,c.E)(s),r()},a.w3),n.src=s}))),new Promise(e=>{t.on("finished",r=>{(0,c.Z6)(r).then(e),t.freeWorkers.forEach(e=>e?.terminate())}).render()})},f=async e=>{let t;let{parseAni:a}=await r.e(8956,"high").then(r.bind(r,18956));try{return{images:[t]}=a(e),l.from(t)}catch{}},m=async(e,t)=>{try{let{default:a}=await r.e(707,"high").then(r.t.bind(r,80707,23)),[n]=a(e).filter(({width:e})=>e<=t).sort((e,t)=>t.width-e.width),s=document.createElement("canvas"),i=s.getContext("2d",{desynchronized:!0});return s.width=n.width,s.height=n.height,i?.putImageData(n,0,0),s.toDataURL()}catch{return""}},g=async(e,t)=>new Promise(r=>{let n=new Image;n.addEventListener("load",()=>r(!0),a.w3),n.addEventListener("error",()=>r(!1),a.w3),n.src=(0,c.Zd)(t,(0,c.hH)("",e))}),p=async(e,t)=>{switch(e){case".jxl":return h(t);case".qoi":return i(t);case".ani":try{return await d(t)}catch{return f(t)}case".cur":return await g(e,t)?t:f(t);default:if(a.U7.has(e))return o(t);if(a.lp.has(e))return l.from((await r.e(7713,"high").then(r.t.bind(r,7713,23))).bufferToURI(t).replace("data:image/png;base64,",""),"base64")}return t}}}]);