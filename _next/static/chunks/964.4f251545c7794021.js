"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[964,2473],{80964:(e,t,a)=>{a.r(t),a.d(t,{default:()=>S});var n=a(74848),r=a(96540),i=a(78744),s=a(48060),o=a(45694),l=a(37e3),u=a(40978);let d=(e,t,a)=>{let{contextMenu:n}=(0,i.b)(),{setWallpaper:d}=(0,o.w)(),{createSnapshot:c}=(0,u.p)(),p=(0,r.useCallback)(async a=>e.current?c(`${t}.png`,(0,l.SJ)(e.current),void 0,!1,a):"",[e,c,t]);return(0,r.useMemo)(()=>n?.(()=>[{action:()=>p(s.Bn),disabled:!a,label:"Save to desktop"},{action:()=>p(s.Sb).then(e=>{e&&d(`${s.Sb}/${e}`)}),disabled:!a,label:"Set as background"}]),[n,a,p,d])};var c=a(33540);let p="hsl(270, 100%, 20%)",f="#fff",m="13px",b="512px",v=c.Ay.div.withConfig({componentId:"sc-a558b8db-0"})(["display:flex;flex-direction:column;place-items:center;nav{display:flex;gap:",";padding:",";width:100%;.prompts{display:flex;flex-direction:column;gap:",";min-width:0;width:100%;textarea{border:1px solid ",";border-radius:",";font-family:",";font-size:12px;padding:",";resize:none;}}button{background:linear-gradient( to bottom right,"," 0%,"," 100% );border:1px solid ",";border-radius:",";color:",";font-size:14px;font-weight:600;padding:10px 15px;&:disabled{background:",";}&:active:not(:disabled){background:",";color:",";}}}.image{display:flex;margin:",";margin-top:0;max-height:",";max-width:",";overflow:auto;place-content:center;place-items:center;position:relative;.status{background-color:",";border:1px solid ",";border-radius:",";box-shadow:rgba(0,0,0,20%) 4px 4px 4px;margin:10px;padding:10px;position:absolute;text-align:center;}canvas{background-color:",";border:1px solid ",";border-radius:",";max-height:100%;max-width:100%;}}"],"5px",m,"5px",p,"4px",({theme:e})=>e.formats.systemFont,"5px","hsl(270, 100%, 30%)",p,p,"4px",f,"#ccc",f,p,m,b,b,f,p,"4px",f,p,"4px");var g=a(24854),h=a(40423),x=a(39913);let w=()=>new Worker(a.tu(new URL(a.p+a.u(8535),a.b)),{name:"Stable Diffusion"}),j=["A photo of an astronaut riding a horse on Mars",""],k="No WebGPU Support",S=()=>{let e=(0,r.useRef)(null),[t,a]=(0,r.useState)(j),i=(0,r.useRef)(!1),s=(0,r.useMemo)(()=>"OffscreenCanvas"in window,[]),o=(0,x.A)(w),l=(0,r.useRef)(!1),[u,c]=(0,r.useState)(k),p=(0,r.useCallback)(async()=>{if(e.current){let a={prompts:[t]};if(s&&o.current){if(l.current)o.current.postMessage({config:a});else{let t=e.current.transferControlToOffscreen();l.current=!0,o.current.postMessage({canvas:t,config:a},[t]),o.current.addEventListener("message",({data:e})=>c(e.message))}}else window.tvmjsGlobalEnv.logger=c,await (0,g.runStableDiffusion)(a,e.current),c("");i.current=!0}},[t,o,s]),f=(0,h._)(),{onContextMenuCapture:m}=d(e,t[0],i.current&&!u);return(0,r.useEffect)(()=>{f&&u===k&&c("")},[f,u]),(0,n.jsxs)(v,{children:[(0,n.jsxs)("nav",{children:[(0,n.jsxs)("div",{className:"prompts",children:[(0,n.jsx)("textarea",{defaultValue:t[0],onChange:({target:e})=>a(([,t])=>[e.value.trim(),t]),placeholder:"Input Prompt"}),(0,n.jsx)("textarea",{defaultValue:t[1],onChange:({target:e})=>a(([t])=>[t,e.value.trim()]),placeholder:"Negative Prompt"})]}),(0,n.jsx)("button",{disabled:!!u||!f||""===t[0]&&""===t[1],onClick:p,type:"button",children:"Generate"})]}),(0,n.jsxs)("div",{className:"image",children:[(0,n.jsx)("canvas",{ref:e,height:512,onContextMenuCapture:m,width:512}),u&&(0,n.jsx)("div",{className:"status",children:u})]})]})}},24854:(e,t,a)=>{a.r(t),a.d(t,{StableDiffusionLibs:()=>r,default:()=>s,runStableDiffusion:()=>i});var n=a(37e3);let r=["/System/tvm/tvmjs_runtime.wasi.js","/System/tvm/tvmjs.bundle.js","/Program Files/StableDiffusion/tokenizers-wasm/tokenizers_wasm.js","/Program Files/StableDiffusion/stable_diffusion.js"],i=async(e,t,a=!1,i=!0)=>{a||(window.tvmjsGlobalEnv=window.tvmjsGlobalEnv||{},await (0,n.aY)(r)),globalThis.tvmjsGlobalEnv.getTokenizer=async()=>(globalThis.tvmjsGlobalEnv.initialized||await globalThis.Tokenizer.init(),globalThis.tvmjsGlobalEnv.initialized=!0,new globalThis.Tokenizer.TokenizerWasm(await (await fetch("/Program Files/StableDiffusion/tokenizers-wasm/tokenizer.json")).text())),i||(globalThis.tvmjsGlobalEnv.canvas=void 0),globalThis.tvmjsGlobalEnv.canvas=globalThis.tvmjsGlobalEnv.canvas||t;let{prompts:s}=e;globalThis.tvmjsGlobalEnv.prompts=s?.length?s:[["A photo of an astronaut riding a elephant on jupiter",""]],await globalThis.tvmjsGlobalEnv.asyncOnGenerate()},s=(e,t={})=>{if(!e)return;let a=document.createElement("canvas");a.height=window.innerHeight,a.width=window.innerWidth,e.append(a),i(t,a)}},40978:(e,t,a)=>{a.d(t,{p:()=>o});var n=a(16286),r=a(96540),i=a(25559),s=a(48060);let o=()=>{let{createPath:e,updateFolder:t}=(0,i.f)();return{createSnapshot:(0,r.useCallback)(async(a,r,i,o=!0,l=s.Sb)=>{let u="";try{if((u=await e(a,l,r,void 0,o))&&i)try{let t="function"==typeof i?await i():i;t&&await e(`${(0,n.join)(l,u)}${s.V9}`,s.jv,t,void 0,o)}catch{}t((0,n.dirname)(l)),t(l,u)}catch{}return u},[e,t])}}},40423:(e,t,a)=>{a.d(t,{_:()=>s});var n=a(96540);let r=!1,i=async()=>{let e;if("undefined"==typeof navigator||!("gpu"in navigator))return!1;try{e=await navigator.gpu.requestAdapter()}catch{return!1}if(!e)return!1;let t=0x40000000>(e.limits.maxBufferSize??0)||0x40000000>(e.limits.maxStorageBufferBindingSize??0)||32768>(e.limits.maxComputeWorkgroupStorageSize??0);return t||(r=!0),!t},s=()=>{let[e,t]=(0,n.useState)(r),a=(0,n.useCallback)(async()=>{await i()&&t(!0)},[]);return(0,n.useEffect)(()=>{e||requestAnimationFrame(a)},[a,e]),e}},39913:(e,t,a)=>{a.d(t,{A:()=>r});var n=a(96540);let r=(e,t,a)=>{let r=(0,n.useRef)(void 0);return(0,n.useEffect)(()=>(e&&!r.current&&(r.current=e(a),t&&r.current.addEventListener("message",t,{passive:!0}),r.current.postMessage("init")),()=>{r.current?.terminate(),r.current=void 0}),[t,a,e]),r}}}]);